name: Test an apworld
description: Setup a base archipelago installation and run tests for the given apworld
inputs:
  ap-version:
    description: The version of archipelago to use. This must either match a refspec in the archipelago repository or be 'latest' to match the latest stable release.
    default: "latest"
    required: true
  python-version:
    description: The python version to use
    required: true
  apworld-path:
    description: The path to the apworld folder or apworld itself
    required: true
  apworld-name:
    description: The name of the apworld. This should only be set if the folder storing your apworld in the repository isn't the same
    type: string
    default: ""
  checkout:
    description: Whether or not to run the checkout step. Can be useful to disable if you want to run tests on a dirty repo
    default: true
    required: true
runs:
  using: composite
  steps:
    - uses: actions/checkout@master
      if: ${{ inputs.checkout != 'false' }}

    - uses: gerbiljames/ap-actions/setup-ap@copy-apworld-source
      with:
        version: ${{ inputs.ap-version }}
        python-version: ${{ inputs.python-version }}

    - uses: gerbiljames/ap-actions/copy-apworld-source@copy-apworld-source
      with:
        apworld-path: ${{ inputs.apworld-path }}
        apworld-name: ${{ inputs.apworld-name }}

    - name: Copy test runner
      shell: bash
      run: |
        cp ${GITHUB_ACTION_PATH}/run_tests.py archipelago/run_tests.py

    - name: Run tests
      shell: bash
      run: |
        cd archipelago && uv run python run_tests.py ${APWORLD_NAME}
